sudo: required
language: c

service:
    - mysql

matrix:
    include:
        - env:
             - JUSTMSQL=true
        - addons:
             mariadb: 5.5
        - addons:
             mariadb: 10.0
        - addons:
             mariadb: 10.1

before_install:
    - sudo apt-get install gnutls-bin
    - sudo install --owner ${USER} -d /etc/mysql/ssl
    - sudo install --owner ${USER} -t /etc/mysql/ssl Makefile *.tmpl
    - sudo install -t /etc/mysql/conf.d ssl.cnf

install:
    - find /etc/mysql -ls
    - pushd /etc/mysql/ssl && make
    - find /etc/mysql -ls
    - sudo service mysql restart
    - popd
    - sudo cat /var/log/syslog
    - mysql -u root < grant.sql

script:
    - mysql --defaults-group-suffix=.ssh -e "show global status like '%ssl'"
    - mysql --defaults-group-suffix=.ssh -e "\s"
    - mysql --ssl-ca /etc/mysql/ssl/ca.crt --ssl-key=/etc/mysql/ssl/client.key --ssl-cert=/etc/mysql/ssl/client.crt --user=travis_ssl -e "\s"
